/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, Input, ElementRef } from '@angular/core';
/**
 * The Intersection Observer API provides a way to asynchronously observe changes in the
 * intersection of a target element with an ancestor element or with a top-level document’s
 * viewport. -MDN
 *
 *
 * The actual detection implementation doesn’t run on the main thread. However, the callback for
 * when an intersection has been triggered does run on the main thread so keep it light!
 *
 * The rootMargin option takes in a string that conforms to the regular CSS margin rule.
 * Here we are telling to increase the bottom dectin boundry by 200px. Meaning the
 * intersection callback will be triggered once the user arrivers at the bottom of the root
 * element +200px (default is 0).
 *
 */
var NgxLazyImagesComponent = /** @class */ (function () {
    function NgxLazyImagesComponent() {
        this.alt = 'Lazy Loaded Image';
        this.defaultConfig = {
            rootMargin: '0px 0px',
        };
        this.config = this.defaultConfig;
        this.visibilityHidden = { visibility: 'hidden' };
    }
    /**
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initPlaceholder();
        this.height = this.height || 0;
        this.width = this.width || 0;
    };
    /**
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.observer = this.initIntersectionObserver();
        this.observer.observe(this.lazyImageEl.nativeElement);
    };
    /**
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.initIntersectionObserver = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return new IntersectionObserver((/**
         * @param {?} entries
         * @return {?}
         */
        function (entries) {
            _this.onIntersection(entries);
        }), tslib_1.__assign({}, this.config));
    };
    // Callback is executed on the main thread, it should operate as quickly as possible.
    // Callback is executed on the main thread, it should operate as quickly as possible.
    /**
     * @param {?} entries
     * @param {?=} observer
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.onIntersection = 
    // Callback is executed on the main thread, it should operate as quickly as possible.
    /**
     * @param {?} entries
     * @param {?=} observer
     * @return {?}
     */
    function (entries, observer) {
        var _this = this;
        entries.forEach((/**
         * @param {?} entry
         * @return {?}
         */
        function (entry) {
            _this.imageLoader(entry);
        }));
    };
    /**
     * @param {?} entry
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.imageLoader = /**
     * @param {?} entry
     * @return {?}
     */
    function (entry) {
        var _this = this;
        var isIntersecting = entry.isIntersecting, target = entry.target;
        try {
            /** @type {?} */
            var image_1 = new Image();
            if (!this.src) {
                console.error('Lazy image element returned empty image source', target);
                return;
            }
            if (isIntersecting) {
                this.fetchImageMeta(image_1, this.src)
                    .then((/**
                 * @return {?}
                 */
                function () {
                    _this.height = _this.height || image_1.height;
                    _this.width = _this.width || image_1.width;
                    _this.lazyImageEl.nativeElement.src = image_1.src;
                    _this.isImgLoaded = true;
                    _this.observer.disconnect();
                }))
                    .catch((/**
                 * @param {?} err
                 * @return {?}
                 */
                function (err) {
                    console.error("Fetching image meta data failed with " + target, err);
                }));
            }
        }
        catch (exception) {
            console.error("Image loader failed with " + target, exception);
        }
    };
    /**
     * @param {?} image
     * @param {?} src
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.fetchImageMeta = /**
     * @param {?} image
     * @param {?} src
     * @return {?}
     */
    function (image, src) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} error
         * @return {?}
         */
        function (resolve, error) {
            image.src = src;
            image.onload = resolve; // eslint-disable-line no-param-reassign
            image.onerror = error; // eslint-disable-line no-param-reassign
        }));
    };
    /**
     * @return {?}
     */
    NgxLazyImagesComponent.prototype.initPlaceholder = /**
     * @return {?}
     */
    function () {
        this.defaultPlaceholder = {
            'position': 'relative',
            'width': '100%',
            'height': '100%',
            'background-color': '#3A6073',
            'background': this.placeholder ? this.placeholder : 'linear-gradient(to right, #3A6073, #16222A)',
            /* blur filters */
            '-webkit-filter': 'blur(5px)',
            '-o-filter': 'blur(5px)',
            'filter': 'blur(5px)',
        };
    };
    NgxLazyImagesComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-lazy-images',
                    template: "<div>\n  <div [style.width]=\"width + 'px'\" [style.height]=\"height + 'px'\" [ngStyle]=\"isImgLoaded ? null : defaultPlaceholder\">\n    <img\n      #lazyImage\n      [alt]=\"alt\"\n      [height]=\"height\"\n      [width]=\"width\"\n      [ngStyle]=\"isImgLoaded ? null : visibilityHidden\"\n    />\n  </div>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    NgxLazyImagesComponent.ctorParameters = function () { return []; };
    NgxLazyImagesComponent.propDecorators = {
        lazyImageEl: [{ type: ViewChild, args: ['lazyImage',] }],
        height: [{ type: Input }],
        width: [{ type: Input }],
        src: [{ type: Input }],
        alt: [{ type: Input }],
        placeholder: [{ type: Input }],
        config: [{ type: Input }]
    };
    return NgxLazyImagesComponent;
}());
export { NgxLazyImagesComponent };
if (false) {
    /** @type {?} */
    NgxLazyImagesComponent.prototype.lazyImageEl;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.height;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.width;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.src;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.alt;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.placeholder;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.defaultConfig;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.config;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.observer;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.isImgLoaded;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.defaultPlaceholder;
    /** @type {?} */
    NgxLazyImagesComponent.prototype.visibilityHidden;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWxhenktaW1hZ2VzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1sYXp5LWxvYWRpbmctaW1hZ2VzLyIsInNvdXJjZXMiOlsibGliL25neC1sYXp5LWltYWdlcy9uZ3gtbGF6eS1pbWFnZXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsS0FBSyxFQUVMLFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCdkI7SUE2QkU7UUFoQlMsUUFBRyxHQUFHLG1CQUFtQixDQUFDO1FBR25DLGtCQUFhLEdBQUc7WUFDZCxVQUFVLEVBQUUsU0FBUztTQUN0QixDQUFDO1FBRU8sV0FBTSxHQUE2QixJQUFJLENBQUMsYUFBYSxDQUFDO1FBTy9ELHFCQUFnQixHQUFHLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDO0lBRTVCLENBQUM7Ozs7SUFFakIseUNBQVE7OztJQUFSO1FBQ0UsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztJQUMvQixDQUFDOzs7O0lBRUQsZ0RBQWU7OztJQUFmO1FBQ0UsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUNoRCxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hELENBQUM7Ozs7SUFFRCx5REFBd0I7OztJQUF4QjtRQUFBLGlCQVNDO1FBUkMsT0FBTyxJQUFJLG9CQUFvQjs7OztRQUM3QixVQUFBLE9BQU87WUFDTCxLQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFD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QUEsQUEvR0QsSUErR0M7U0ExR1ksc0JBQXNCOzs7SUFDakMsNkNBQWdEOztJQUdoRCx3Q0FBd0I7O0lBQ3hCLHVDQUF1Qjs7SUFFdkIscUNBQXFCOztJQUNyQixxQ0FBbUM7O0lBQ25DLDZDQUE2Qjs7SUFFN0IsK0NBRUU7O0lBRUYsd0NBQStEOztJQUUvRCwwQ0FBK0I7O0lBQy9CLDZDQUFxQjs7SUFFckIsb0RBQXdCOztJQUV4QixrREFBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIFZpZXdDaGlsZCxcbiAgSW5wdXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIEVsZW1lbnRSZWYsIE9uSW5pdFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuLyoqXG4gKiBUaGUgSW50ZXJzZWN0aW9uIE9ic2VydmVyIEFQSSBwcm92aWRlcyBhIHdheSB0byBhc3luY2hyb25vdXNseSBvYnNlcnZlIGNoYW5nZXMgaW4gdGhlXG4gKiBpbnRlcnNlY3Rpb24gb2YgYSB0YXJnZXQgZWxlbWVudCB3aXRoIGFuIGFuY2VzdG9yIGVsZW1lbnQgb3Igd2l0aCBhIHRvcC1sZXZlbCBkb2N1bWVudOKAmXNcbiAqIHZpZXdwb3J0LiAtTUROXG4gKlxuICpcbiAqIFRoZSBhY3R1YWwgZGV0ZWN0aW9uIGltcGxlbWVudGF0aW9uIGRvZXNu4oCZdCBydW4gb24gdGhlIG1haW4gdGhyZWFkLiBIb3dldmVyLCB0aGUgY2FsbGJhY2sgZm9yXG4gKiB3aGVuIGFuIGludGVyc2VjdGlvbiBoYXMgYmVlbiB0cmlnZ2VyZWQgZG9lcyBydW4gb24gdGhlIG1haW4gdGhyZWFkIHNvIGtlZXAgaXQgbGlnaHQhXG4gKlxuICogVGhlIHJvb3RNYXJnaW4gb3B0aW9uIHRha2VzIGluIGEgc3RyaW5nIHRoYXQgY29uZm9ybXMgdG8gdGhlIHJlZ3VsYXIgQ1NTIG1hcmdpbiBydWxlLlxuICogSGVyZSB3ZSBhcmUgdGVsbGluZyB0byBpbmNyZWFzZSB0aGUgYm90dG9tIGRlY3RpbiBib3VuZHJ5IGJ5IDIwMHB4LiBNZWFuaW5nIHRoZVxuICogaW50ZXJzZWN0aW9uIGNhbGxiYWNrIHdpbGwgYmUgdHJpZ2dlcmVkIG9uY2UgdGhlIHVzZXIgYXJyaXZlcnMgYXQgdGhlIGJvdHRvbSBvZiB0aGUgcm9vdFxuICogZWxlbWVudCArMjAwcHggKGRlZmF1bHQgaXMgMCkuXG4gKiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtbGF6eS1pbWFnZXMnLFxuICB0ZW1wbGF0ZVVybDogJy4vbmd4LWxhenktaW1hZ2VzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hMYXp5SW1hZ2VzQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25Jbml0IHtcbiAgQFZpZXdDaGlsZCgnbGF6eUltYWdlJykgbGF6eUltYWdlRWw6IEVsZW1lbnRSZWY7XG5cbiAgLy8gSW1hZ2UgTWV0YSBEYXRhXG4gIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xuICBASW5wdXQoKSB3aWR0aDogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIHNyYzogc3RyaW5nO1xuICBASW5wdXQoKSBhbHQgPSAnTGF6eSBMb2FkZWQgSW1hZ2UnO1xuICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nO1xuXG4gIGRlZmF1bHRDb25maWcgPSB7XG4gICAgcm9vdE1hcmdpbjogJzBweCAwcHgnLFxuICB9O1xuXG4gIEBJbnB1dCgpIGNvbmZpZzogSW50ZXJzZWN0aW9uT2JzZXJ2ZXJJbml0ID0gdGhpcy5kZWZhdWx0Q29uZmlnO1xuXG4gIG9ic2VydmVyOiBJbnRlcnNlY3Rpb25PYnNlcnZlcjtcbiAgaXNJbWdMb2FkZWQ6IGJvb2xlYW47XG5cbiAgZGVmYXVsdFBsYWNlaG9sZGVyOiBhbnk7XG5cbiAgdmlzaWJpbGl0eUhpZGRlbiA9IHsgdmlzaWJpbGl0eTogJ2hpZGRlbicgfTtcblxuICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5pdFBsYWNlaG9sZGVyKCk7XG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmhlaWdodCB8fCAwO1xuICAgIHRoaXMud2lkdGggPSB0aGlzLndpZHRoIHx8IDA7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5vYnNlcnZlciA9IHRoaXMuaW5pdEludGVyc2VjdGlvbk9ic2VydmVyKCk7XG4gICAgdGhpcy5vYnNlcnZlci5vYnNlcnZlKHRoaXMubGF6eUltYWdlRWwubmF0aXZlRWxlbWVudCk7XG4gIH1cblxuICBpbml0SW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTogSW50ZXJzZWN0aW9uT2JzZXJ2ZXIge1xuICAgIHJldHVybiBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXG4gICAgICBlbnRyaWVzID0+IHtcbiAgICAgICAgdGhpcy5vbkludGVyc2VjdGlvbihlbnRyaWVzKTtcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIC4uLnRoaXMuY29uZmlnLFxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvLyBDYWxsYmFjayBpcyBleGVjdXRlZCBvbiB0aGUgbWFpbiB0aHJlYWQsIGl0IHNob3VsZCBvcGVyYXRlIGFzIHF1aWNrbHkgYXMgcG9zc2libGUuXG4gIG9uSW50ZXJzZWN0aW9uKGVudHJpZXM6IEludGVyc2VjdGlvbk9ic2VydmVyRW50cnlbXSwgb2JzZXJ2ZXI/OiBhbnkpIHtcbiAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgdGhpcy5pbWFnZUxvYWRlcihlbnRyeSk7XG4gICAgfSk7XG4gIH1cblxuICBpbWFnZUxvYWRlcihlbnRyeTogSW50ZXJzZWN0aW9uT2JzZXJ2ZXJFbnRyeSkge1xuICAgIGNvbnN0IHsgaXNJbnRlcnNlY3RpbmcsIHRhcmdldCB9ID0gZW50cnk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgICAgaWYgKCF0aGlzLnNyYykge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdMYXp5IGltYWdlIGVsZW1lbnQgcmV0dXJuZWQgZW1wdHkgaW1hZ2Ugc291cmNlJywgdGFyZ2V0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgdGhpcy5mZXRjaEltYWdlTWV0YShpbWFnZSwgdGhpcy5zcmMpXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLmhlaWdodCB8fCBpbWFnZS5oZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy53aWR0aCB8fCBpbWFnZS53aWR0aDtcbiAgICAgICAgICAgIHRoaXMubGF6eUltYWdlRWwubmF0aXZlRWxlbWVudC5zcmMgPSBpbWFnZS5zcmM7XG4gICAgICAgICAgICB0aGlzLmlzSW1nTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZldGNoaW5nIGltYWdlIG1ldGEgZGF0YSBmYWlsZWQgd2l0aCAke3RhcmdldH1gLCBlcnIpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xuICAgICAgY29uc29sZS5lcnJvcihgSW1hZ2UgbG9hZGVyIGZhaWxlZCB3aXRoICR7dGFyZ2V0fWAsIGV4Y2VwdGlvbik7XG4gICAgfVxuICB9XG5cbiAgZmV0Y2hJbWFnZU1ldGEoaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQsIHNyYzogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIGVycm9yKSA9PiB7XG4gICAgICBpbWFnZS5zcmMgPSBzcmM7XG4gICAgICBpbWFnZS5vbmxvYWQgPSByZXNvbHZlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgICBpbWFnZS5vbmVycm9yID0gZXJyb3I7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICB9KTtcbiAgfVxuXG4gIGluaXRQbGFjZWhvbGRlcigpIHtcbiAgICB0aGlzLmRlZmF1bHRQbGFjZWhvbGRlciA9IHtcbiAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScsXG4gICAgICAnd2lkdGgnOiAnMTAwJScsXG4gICAgICAnaGVpZ2h0JzogJzEwMCUnLFxuICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAnIzNBNjA3MycsXG4gICAgICAnYmFja2dyb3VuZCc6IHRoaXMucGxhY2Vob2xkZXIgPyB0aGlzLnBsYWNlaG9sZGVyIDogJ2xpbmVhci1ncmFkaWVudCh0byByaWdodCwgIzNBNjA3MywgIzE2MjIyQSknLFxuICAgICAgLyogYmx1ciBmaWx0ZXJzICovXG4gICAgICAnLXdlYmtpdC1maWx0ZXInOiAnYmx1cig1cHgpJyxcbiAgICAgICctby1maWx0ZXInOiAnYmx1cig1cHgpJyxcbiAgICAgICdmaWx0ZXInOiAnYmx1cig1cHgpJyxcbiAgICB9O1xuICB9XG5cbn1cbiJdfQ==